<!-- No Exercises -->
<div class="panel panel-default" *ngIf="exercises?.length < 1">
  <div class="panel-body msg-info">
    <span class="fa fa-info-circle"></span>{{text['NoWordsInLesson']}}
  </div>
</div>
<!-- Exercise list -->
<div class="exercises" *ngIf="exercises?.length > 0">
  <ul 
    class="list-unstyled list list-group"
    dnd-sortable-container
    [sortableData]="exercises">
    <li *ngFor="let exercise of exercises; let i = index;">
      <div 
        [class.editing]="editingId === exercise._id"
        [class.viewing]="viewId === exercise._id"
        class="list-group-item row"
        dnd-sortable
        [sortableIndex]="i"
        (onDropSuccess)="onResorted($event)">
        <div class="pull-right">
          <span 
            class="btn btn-danger fa fa-trash-o"
            (click)="onRemoveExercise(confirm, exercise._id)">
          </span>
          <span 
            class="btn btn-primary fa fa-pencil"
            (click)="onEditExercise(exercise._id)">
          </span>
          <span 
            class="btn btn-info fa fa-eye"
            (click)="onViewExercise(exercise._id)">
          </span>
        </div>
        <div class="items">
          {{i + 1}}. 
          <span class="item active" [ngSwitch]="exercise.tpe">
            <span class="fa fa-font" *ngSwitchDefault></span>
            <span class="fa fa-list-alt" *ngSwitchCase="exType.Select"></span>
            <span class="fa fa-comments" *ngSwitchCase="exType.QA"></span>
            <span class="fa fa-terminal" *ngSwitchCase="exType.FillIn"></span>
          </span>
          <span class="item" [class.active]="!!exercise.audio">
            <span class="fa fa-volume-up"></span>
          </span>
          <span class="item" [class.active]="!!exercise.image">
            <span class="fa fa-camera"></span>
          </span>
        </div>
        <!-- WORD -->
        <div *ngIf="exercise.tpe === exType.Word">
          <div class="col-xs-4">
            <div class="words">
              <span (dblclick)="onEditExercise(exercise._id, 'foreignWord')">
                <strong>{{exercise.foreign?.word}}</strong>
              </span> / 
              <span (dblclick)="onEditExercise(exercise._id, 'localWord')">
                {{exercise.local?.word}}
              </span>
              <div [innerHTML]="getInfoAlt(exercise)" class="sublines"></div>
            </div>
          </div>
          <div class="col-xs-2 annotations">
            {{getInfo(exercise)}}
            <span>
              <div [innerHTML]="getInfoHint(exercise, 'foreign')"></div>
            </span>
          </div>
          <div class="col-xs-2 annotations">
            <div [innerHTML]="getInfoHint(exercise, 'local')"></div>
          </div>
        </div>
        <!-- SENTENCE -->
        <div *ngIf="exercise.tpe === exType.Select">
          <div class="col-xs-6">
            <div class="words">
              <span (dblclick)="onEditExercise(exercise._id, 'foreignWord')">
                <strong>{{exercise.foreign?.word}}</strong>
              </span> / 
              <span (dblclick)="onEditExercise(exercise._id, 'localWord')">
                {{exercise.local?.word}}
              </span>
            </div>
          </div>
          <div class="col-xs-2 annotations">
            <div [innerHTML]="getSelectOptions(exercise)"></div>
          </div>
        </div>
        <!-- QA -->
        <div *ngIf="exercise.tpe === exType.QA">
          <div class="col-xs-8">
            <div class="words">
              <span 
                (dblclick)="onEditExercise(exercise._id, 'foreignWord')">
                <strong>{{exercise.foreign?.word}}</strong>
              </span> <span *ngIf="exercise.foreign?.word">/</span>
              <span (dblclick)="onEditExercise(exercise._id)">
                {{exercise.foreign?.hint}}
              </span>
            </div>
          </div>
        </div>
        <!-- Fill In -->
        <div *ngIf="exercise.tpe === exType.FillIn">
          <div class="col-xs-8">
            <div class="words">
              <span 
                (dblclick)="onEditExercise(exercise._id, 'foreignWord')">
                <strong>{{exercise.foreign?.word}}</strong>
              </span> <span *ngIf="exercise.foreign?.word">/</span>
              <span (dblclick)="onEditExercise(exercise._id)">
                {{exercise.foreign?.hint}}
              </span>
            </div>
          </div>
        </div>
      </div>
      <!-- EDIT / VIEW Exercise -->
      <div *ngIf="exercise._id===viewId">
        <km-preview-question class="view"
          [lanPair]="languagePair"
          [exercise]="exercise"
          [text]="text">
        </km-preview-question>
      </div>
      <div *ngIf="exercise._id===editingId">
        <km-build-exercise *ngIf="exercise.tpe === exType.Word" class="edit"
          [languagePair]="languagePair"
          [lessonId]="lessonId"
          [exercise]="exercise"
          [text]="text"
          [focus]="focusField"
          [isBidirectional]="isBidirectional"
          (updatedExercise)="onUpdatedExercise($event)"
          (cancelEdit)="onCancelEdit()">
        </km-build-exercise>
        <km-build-select *ngIf="exercise.tpe === exType.Select" class="edit"
          [languagePair]="languagePair"
          [lessonId]="lessonId"
          [exercise]="exercise"
          [text]="text"
          (updatedExercise)="onUpdatedExercise($event)"
          (cancelEdit)="onCancelEdit()">
        </km-build-select>
        <km-build-qa *ngIf="exercise.tpe === exType.QA" class="edit"
          [languagePair]="languagePair"
          [lessonId]="lessonId"
          [exercise]="exercise"
          [text]="text"
          (updatedExercise)="onUpdatedExercise($event)"
          (cancelEdit)="onCancelEdit()">
        </km-build-qa>
        <km-build-fillin *ngIf="exercise.tpe === exType.FillIn" class="edit"
          [languagePair]="languagePair"
          [lessonId]="lessonId"
          [exercise]="exercise"
          [text]="text"
          (updatedExercise)="onUpdatedExercise($event)"
          (cancelEdit)="onCancelEdit()">
        </km-build-fillin>
      </div>
    </li>
  </ul>
</div>

<km-modal-confirm #confirm
  [level]="'warning'"
  [text]="text"
  (confirmed)="onRemoveConfirmed($event)">
  <div title>{{text["Warning"]}}</div>
  <div message>{{getRemoveMessage()}}</div>
</km-modal-confirm>
