<div *ngIf="isCourseAccess">

  <km-build-course-header-bar
    *ngIf="course"
    [text]="text"
    [course]="course"
    [showLink]="true">
  </km-build-course-header-bar>

  <h2 *ngIf="!isEditMode" class="header">
    {{lesson?.name}}
    <div class="btn btn-warning" (click)="onEditLesson()">
      <span class="fa fa-cog"></span> {{text["Settings"]}}
    </div>
  </h2>

  <km-build-lesson-header *ngIf="isEditMode" class="header"
    [lesson]="lesson"
    [defaults]="course.defaults"
    [text]="text"
    [chapters]="chapters"
    (done)="onCloseHeader($event)">
  </km-build-lesson-header>

  <km-build-lesson-tabs
    [text]="text"
    [tab]="tab"
    [isIntro]="lesson?.exerciseSteps?.intro?.active"
    (selected)="onTabSelected($event)">
  </km-build-lesson-tabs>

  <div *ngIf="tab==='words'">
    <km-exercise-list 
      *ngIf="lesson"
      [languagePair]="lesson?.languagePair"
      [configs]="configs"
      [lessonId]="lesson?._id"
      [lessonOptions]="lesson?.options"
      [text]="text"
      [isBidirectional]="isBidirectional"
      [exercises]="lesson.exercises"
      (removedExercise)="onExerciseRemoved($event)">
    </km-exercise-list>

    <div class="footer">
      <div *ngIf="!isNewExercise; else addExercise">
        <div align="" class="btn btn-success btn-lg" (click)="onNewWord()">
          <span class="fa fa-font fa-spacing"></span>
          {{text["NewWord"]}}
        </div>

        <div class="btn-group" #dropdown>
          <button 
            type="button"
            data-toggle="dropdown"
            class="btn btn-success btn-lg dropdown-toggle"
            (click)="onToggleDropDown()">
            <span class="fa fa-file-o fa-spacing"></span>
            {{text["New..."]}}
            <span class="caret"></span>
          </button>
          <ul class="dropdown-menu" 
            [style.display]="showDropDown ? 'block' : 'none'">
            <li (click)="onNewSelect()"><a>
              <span class="fa fa-list-alt fa-spacing"></span>{{text["NewSelect"]}}
            </a></li>
            <li (click)="onNewQA()"><a>
              <span class="fa fa-comments fa-spacing"></span>{{text["NewQA"]}}
            </a></li>
            <li (click)="onNewFillIn()"><a>
              <span class="fa fa-terminal fa-spacing"></span>{{text["NewFillIn"]}}
            </a></li>
          </ul>
        </div>
      </div>
    </div>

    <ng-template #addExercise>
      <km-build-exercise
        *ngIf="tpe===exType.Word"
        [languagePair]="lesson?.languagePair"
        [configs]="configs"
        [lessonId]="lesson?._id"
        [text]="text"
        [lessonOptions]="lesson?.options"
        (addedExercises)="onExercisesAdded($event)"
        (cancelNew)="onCancelNew()">
      </km-build-exercise>
      <km-build-select *ngIf="tpe===exType.Select"
        [languagePair]="lesson?.languagePair"
        [configs]="configs"
        [lessonId]="lesson?._id"
        [text]="text"
        (addedExercises)="onExercisesAdded($event)"
        (cancelNew)="onCancelNew()">
      </km-build-select>
      <km-build-qa *ngIf="tpe===exType.QA"
        [languagePair]="lesson?.languagePair"
        [configs]="configs"
        [lessonId]="lesson?._id"
        [text]="text"
        (addedExercises)="onExercisesAdded($event)"
        (cancelNew)="onCancelNew()">
      </km-build-qa>
      <km-build-fillin *ngIf="tpe===exType.FillIn"
        [languagePair]="lesson?.languagePair"
        [configs]="configs"
        [lessonId]="lesson?._id"
        [text]="text"
        (addedExercises)="onExercisesAdded($event)"
        (cancelNew)="onCancelNew()">
      </km-build-fillin>
    </ng-template>
  </div>

  <km-build-lesson-intro *ngIf="tab==='intro'"
    [lessonId]="lesson?._id"
    [text]="text">
  </km-build-lesson-intro>
</div>

<km-info-msg [msg]="infoMsg" *ngIf="infoMsg">
</km-info-msg>