<km-lesson-selector
  *ngIf="course"
  [course]="course"
  [text]="text"
  (currentLesson)="onLessonSelected($event)">
</km-lesson-selector>

<div *ngIf="isStepsReady">
  <ul class="list-unstyled list-inline lead steps">
    <ng-template ngFor [ngForOf]="steps" let-step let-i="index">
      <li 
        *ngIf="i === steps.length - 1"
        (click)="stepTo(i)" 
        class="btn btn-lg btn-info pull-right"
        [class.inactive]="currentStep!==i">
        {{text['Overview']}}
      </li>
      <li 
        *ngIf="i < steps.length - 1"
        (click)="stepTo(i)" 
        class="btn btn-lg"
        [class.btn-success]="step==='intro'"
        [class.btn-primary]="step==='review'"
        [class.btn-danger]="step==='exam'"
        [class.btn-info]="step!=='intro'"
        [class.inactive]="currentStep!==i">
        {{text[step.charAt(0).toUpperCase() + step.slice(1)]}} <span *ngIf="step !== 'intro'">({{countPerStep[step]?.nrRemaining}})</span>
      </li>
      <li class="arrow" *ngIf="i < steps.length - 2">
        <span class="fa fa-arrow-right"></span>
      </li>
    </ng-template>
  </ul>
</div>
<div [ngSwitch]="steps[currentStep]" class="learn" [ngClass]="steps[currentStep]" *ngIf="isStepsReady">
  <km-learn-study  *ngSwitchCase="'study'"
    [exercises]="lesson.exercises"
    [lanPair]="course.languagePair"
    [lessonId]="this.lesson._id"
    [text]="text"
    [options]="lesson?.exerciseTpes.study"
    [settings]="settings"
    (skipStep)="onSkipStep()"
    (stepCompleted)="onStepCompleted('study', $event)"
    (updatedSettings)="onSettingsUpdated($event)"
  >
  </km-learn-study>
  <km-learn-practise *ngSwitchCase="'practise'"
    [exercises]="lesson.exercises"
    [lanPair]="course.languagePair"
    [options]="lesson?.exerciseTpes.practise"
    [lessonId]="this.lesson._id"
    [text]="text"
    [settings]="settings"
    (stepCompleted)="onStepCompleted('practise', $event)"
    (updatedSettings)="onSettingsUpdated($event)"
  >
  </km-learn-practise>
  <km-learn-overview *ngSwitchCase="'overview'"
    [lessonId]="lesson._id"
    [exercises]="lesson.exercises"
  >
  </km-learn-overview>
</div>

<km-info-msg
  [msg]="infoMsg">
</km-info-msg>
<km-error-msg
  [msg]="errorMsg">
</km-error-msg>
