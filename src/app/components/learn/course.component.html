<div class="closeExercises" *ngIf="exercisesStarted">
  <span class="fa fa-times pull-right" (click)="onExitExercises(confirmexit)"></span>
</div>

<!-- COURSE HEADER -->
<div *ngIf="isStepsReady">
  <div class="panel panel-default panel-header">
    <div class="panel-body">
      <h1>
        <button type="button" 
          class="btn btn-success pull-right"
          (click)="onContinueCourse()">
          <span class="fa fa-arrow-right"></span>{{text["continuecourse"]}}
        </button>
        <img src="/assets/img/flags/{{course?.languagePair.to}}.png" class="flag">
        <span class="course-title">{{course?.name}}</span>
      </h1>
      <ul class="list-unstyled list-inline steps">
        <ng-template ngFor [ngForOf]="steps" let-step let-i="index">
          <li 
            (click)="stepTo(i)" 
            class="btn btn-lg btn-step"
            [ngClass]="{
              'btn-overview': step.name==='overview',
              'btn-intro': step.name==='intro',
              'btn-study': step.name==='study',
              'btn-practise': step.name==='practise',
              'btn-review': step.name==='review', 
              'btn-difficult': step.name==='difficult',
              'btn-exam': step.name==='exam',
              'active': currentStep===i,
              'inactive': currentStep!==i,
              'pull-right': step.level === level.Course
            }">
            <span class="fa fa-spacing" [ngClass]="{
              'fa-repeat': step.name==='review', 
              'fa-fire': step.name==='difficult',
              'fa-clock-o': step.name==='exam'
            }"></span>
            {{text[capitalize(step.name)]}} <span class="remaining" *ngIf="step.name !== 'intro'">({{countPerStep[step.name]?.nrRemaining}})</span>
          </li>
        </ng-template>
      </ul>
    </div>
  </div>
  <div class="learn-header"
    [ngClass]="steps[currentStep]?.name">
  </div>
</div>
<!-- COURSE DATA -->
<div *ngIf="isStepsReady && course">
  <div 
    [ngSwitch]="steps[currentStep]?.name"
    class="learn"
    [ngClass]="steps[currentStep]?.name">
    <km-learn-intro *ngSwitchCase="'intro'"
      [lessonId]="this.lesson._id"
      [text]="text"
      (stepCompleted)="onStepCompleted('intro', null)">
    </km-learn-intro>
    <km-learn-study  *ngSwitchCase="'study'"
      [exercises]="lesson.exercises"
      [lanPair]="course.languagePair"
      [lessonId]="this.lesson._id"
      [text]="text"
      [isDemo]="this.isDemo"
      [stepOptions]="lesson.exerciseSteps.study"
      [settings]="settings"
      [exercisesInterrupted]="exercisesInterrupted"
      (skipStep)="onSkipStep()"
      (stepCompleted)="onStepCompleted('study', $event)"
      (updatedSettings)="onSettingsUpdated($event)">
    </km-learn-study>
    <km-learn-practise *ngSwitchCase="'practise'"
      [exercises]="lesson.exercises"
      [lanPair]="course.languagePair"
      [stepOptions]="lesson.exerciseSteps.practise"
      [lessonOptions]="lesson.options"
      [lessonId]="lesson._id"
      [courseId]="courseId"
      [text]="text"
      [learnedLevel]="isLearnedLevel"
      [hasStudyTab]="hasStep('study')"
      [settings]="settings"
      [exercisesInterrupted]="exercisesInterrupted"
      [stepcountzero]="stepcountzero"
      (lessonCompleted)="onLessonCompleted($event)"
      (stepCompleted)="onStepCompleted('practise', $event)"
      (stepBack)="onStepBack()"
      (updatedSettings)="onSettingsUpdated($event)">
    </km-learn-practise>
    <km-learn-review *ngSwitchCase="'review'"
      [courseId]="courseId"
      [lanPair]="course.languagePair"
      [text]="text"
      [settings]="settings"
      [lessonOptions]="lesson.options"
      [exercisesInterrupted]="exercisesInterrupted"
      [stepcountzero]="stepcountzero"
      (stepCompleted)="onStepCompleted('review', $event)"
      (updatedSettings)="onSettingsUpdated($event)">
    </km-learn-review>
    <km-learn-difficult *ngSwitchCase="'difficult'"
      [courseId]="courseId"
      [lanPair]="course.languagePair"
      [text]="text"
      [settings]="settings"
      [lessonOptions]="lesson.options"
      [exercisesInterrupted]="exercisesInterrupted"
      [stepcountzero]="stepcountzero"
      (stepCompleted)="onStepCompleted('difficult', $event)"
      (updatedSettings)="onSettingsUpdated($event)">
    </km-learn-difficult>
    <km-learn-overview *ngSwitchCase="'overview'"
      [course]="course"
      [currentLessonId]="lesson._id"
      [isLearnedLevel]="isLearnedLevel"
      [text]="text"
      (currentLesson)="onLessonSelected($event)">
    </km-learn-overview>
  </div>
</div>

<km-info-msg
  [msg]="infoMsg">
</km-info-msg>
<km-error-msg
  [msg]="errorMsg">
</km-error-msg>

<km-modal-confirm #confirmexit
  [level]="'warning'"
  [text]="text"
  (confirmed)="onExitConfirmed($event)">
  <div title>{{text["Warning"]}}</div>
  <div message>{{text["ConfirmExit"]}}</div>
</km-modal-confirm>
