<km-countdown 
  *ngIf="isCountDown; else exercise"
  [mute]="isMute"
  (countedDown)="onCountDownFinished()">
</km-countdown>

<ng-template #exercise>
  <section kmPressed 
    (onKeyPressed)="onKeyPressed($event)">
    <div class="col-xs-8">
      <div class="panel centerpanel">
        <km-bullets *ngIf="!isExercisesDone"
          [exercises]="exerciseData"
          [current]="current"
          [onNextExercise]="nextExercise">
        </km-bullets>
        <!-- EXERCISE -->
        <div *ngIf="!isExercisesDone && isQuestionReady" 
          class="card" 
          [class.preview]="isQuestionType(qType.Preview)">
          <div *ngIf="currentData?.data?.isCaseSensitive"
            class="pull-right case">
            Aa
          </div>
          <div *ngIf="!isQuestionType(qType.Select) && !isQuestionType(qType.FillIn) && !isQuestionType(qType.Comparison)"
            class="clearfix">
            <!-- IMAGE -->
            <div class="image" *ngIf="currentData.exercise.image">
              <img src="{{currentData.exercise.image}}">
            </div>
            <km-question
              [currentData]="currentData"
              [lanPair]="lanPair"
              [text]="text"
              [showAlt]="true"
              [dir]="getQuestionDir()"
              [settings]="settings"
            ></km-question>
          </div>
          <km-word-choices *ngIf="isQuestionType(qType.Choices)"
            [choices]="currentChoices"
            [correct]="currentData?.data?.isCorrect"
            [answer]="answer"
            [answered]="answered"
            [isSelected]="isAnswered"
            [instruction]="text['instructionChoices']"
            (selected)="onSelected($event)">
          </km-word-choices>
          <km-word-field *ngIf="isQuestionType(qType.Word)"
            [lan]="lanPair.to"
            [prefix]="prefix"
            [disabled]="isAnswered"
            [keyboard]="{showKeyboard: settings.keyboard, keys: keys}"
            [solution]="{solution: solution, msg: text['Expectedanswer']}"
            [instruction]="text['instructionWordfield']"
            [data]="currentData?.data">
          </km-word-field>
          <km-select *ngIf="isQuestionType(qType.Select)"
            [lanPair]="lanPair"
            [data]="currentData"
            [text]="text"
            (answered)="onAnsweredSelect($event)">
          </km-select>
          <km-qa *ngIf="isQuestionType(qType.FillIn)"
            [lanPair]="lanPair"
            [data]="currentData"
            [text]="text"
            [keyboard]="{showKeyboard: settings.keyboard, keys: keys}">
          </km-qa>
          <km-comparison *ngIf="isQuestionType(qType.Comparison)"
            [lanPair]="lanPair"
            [data]="currentData"
            [text]="text"
            [keyboard]="{showKeyboard: settings.keyboard, keys: keys}">
          </km-comparison>
          <div *ngIf="isQuestionType(qType.Preview)" class="answer">
            <h1 class="word">
              <span>
                <img src="/assets/img/flags/{{lanPair.from}}.png" class="flag">
              </span>
              <span>
                {{currentData.exercise?.local?.word}}
                <div class="alts">{{getAlts('local', currentData.exercise)}}</div>
              </span>
            </h1>
          </div>
        </div>
        <!-- NO MORE EXERCISES -->
        <div *ngIf="noMoreExercises && !isExercisesDone">
          <div class="msg-info nomore">
            <span class="fa fa-info-circle"></span>{{text['NoMoreDifficultExercises']}}
          </div>
        </div>
        <!-- EXERCISE DONE -->
        <div *ngIf="isExercisesDone">
          <h3>{{text["Results"]}}:</h3>
          <km-completed-list
            [data]="exerciseData"
            [text]="text">
          </km-completed-list>
          <h3>{{text["PointsEarned"]}}:</h3>
          <km-points-completed [data]="exerciseData">
          </km-points-completed>
          <button type="button" class="btn btn-success" (click)="onRestart()" *ngIf="!noMoreExercises">
            <span class="fa fa-step-forward"></span>
            {{text["ContinueDifficult"]}}
          </button>
        </div>
      </div>
    </div>
    <div class="col-xs-4">
      <km-learn-settings *ngIf="!noMoreExercises"
        [step]="'difficult'"
        [hasGenus]="!!this.currentData?.exercise.genus"
        [settings]="settings"
        [isInput]="isQuestionType(qType.Word)"
        [isActive]="!isExercisesDone"
        (updatedSettings)="onSettingsUpdated($event)">
      </km-learn-settings>
      <div class="actions" *ngIf="!noMoreExercises">
        <button 
          type="button"
          *ngIf="!isExercisesDone"
          [disabled]="!isAnswered && isSelectionExercise()"
          class="btn btn-lg btn-success next" 
          (click)="onNextWord()">
          <span class="fa fa-step-forward"></span>
          {{!isAnswered && isEnterDataExercise() ? text["Check"] : text["Next"]}}
        </button>
      </div>
      <div class="score" *ngIf="!isExercisesDone">
        <km-points-earned [pointsEarned]="pointsEarned">
        </km-points-earned>
      </div>
    </div>
    <div class="clearfix"></div>
  </section>
</ng-template>

